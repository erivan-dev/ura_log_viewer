<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>URA Log Viewer V1.10.1</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@300;400;500;600&family=Syne:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #09090f;
            --surface: #10101a;
            --surface2: #161625;
            --border: #1e1e35;
            --border2: #2a2a48;
            --accent: #4f6ef7;
            --accent2: #7c5cfc;
            --cyan: #00e5c8;
            --green: #00d68f;
            --amber: #f5a623;
            --red: #ff4d6d;
            --text: #e8e8f0;
            --text2: #8888aa;
            --text3: #4a4a6a;
            --mono: 'IBM Plex Mono', monospace;
            --sans: 'Syne', sans-serif;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background: var(--bg);
            color: var(--text);
            font-family: var(--mono);
            font-size: 13px;
            min-height: 100vh;
            padding: 28px 32px;
        }

        body::before {
            content: '';
            position: fixed;
            inset: 0;
            background-image:
                linear-gradient(var(--border) 1px, transparent 1px),
                linear-gradient(90deg, var(--border) 1px, transparent 1px);
            background-size: 40px 40px;
            opacity: 0.3;
            pointer-events: none;
            z-index: 0;
        }

        .container {
            position: relative;
            z-index: 1;
            max-width: 1440px;
            margin: 0 auto;
        }

        /* ── HEADER ── */
        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 28px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border2);
            animation: fadeDown 0.4s ease;
        }

        .header-left { display: flex; align-items: center; gap: 14px; }

        .logo-badge {
            width: 42px; height: 42px;
            background: linear-gradient(135deg, var(--accent), var(--accent2));
            border-radius: 11px;
            display: flex; align-items: center; justify-content: center;
            font-family: var(--sans); font-weight: 800; font-size: 13px;
            letter-spacing: -0.5px;
            box-shadow: 0 0 28px rgba(79,110,247,0.4);
            flex-shrink: 0;
        }

        .header-title {
            font-family: var(--sans);
            font-weight: 700; font-size: 19px; letter-spacing: -0.3px;
        }

        .header-subtitle {
            color: var(--text2); font-size: 11px; margin-top: 3px; letter-spacing: 0.5px;
        }

        .version-tag {
            background: var(--surface2);
            border: 1px solid var(--border2);
            color: var(--text2);
            padding: 5px 12px; border-radius: 20px;
            font-size: 11px; letter-spacing: 0.5px;
        }

        /* ── TEXTAREA ── */
        .input-section {
            margin-bottom: 20px;
            animation: fadeDown 0.5s ease 0.05s backwards;
        }

        .input-label {
            display: flex; align-items: center; gap: 8px;
            color: var(--text2); font-size: 10px; text-transform: uppercase;
            letter-spacing: 1.2px; margin-bottom: 8px;
        }

        .input-label::before {
            content: ''; width: 6px; height: 6px;
            background: var(--accent); border-radius: 50%;
        }

        textarea {
            width: 100%;
            height: 130px;
            background: var(--surface);
            color: var(--cyan);
            border: 1px solid var(--border2);
            border-radius: 10px;
            padding: 14px 16px;
            font-family: var(--mono);
            font-size: 12px;
            line-height: 1.6;
            white-space: pre;
            overflow-x: auto;
            resize: vertical;
            outline: none;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        textarea:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(79,110,247,0.15);
        }

        /* ── ACTIONS ── */
        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 28px;
            flex-wrap: wrap;
            animation: fadeDown 0.5s ease 0.1s backwards;
        }

        button {
            display: flex; align-items: center; gap: 8px;
            padding: 10px 20px;
            border-radius: 8px; border: none;
            cursor: pointer;
            font-family: var(--mono); font-size: 12px; font-weight: 600;
            letter-spacing: 0.3px;
            transition: all 0.2s;
        }

        button.primary {
            background: linear-gradient(135deg, var(--accent), var(--accent2));
            color: #fff;
            box-shadow: 0 4px 18px rgba(79,110,247,0.35);
        }

        button.primary:hover {
            box-shadow: 0 6px 28px rgba(79,110,247,0.55);
            transform: translateY(-1px);
        }

        button.secondary {
            background: transparent;
            border: 1px solid var(--border2);
            color: var(--text2);
        }

        button.secondary:hover {
            border-color: var(--accent);
            color: var(--accent);
            background: rgba(79,110,247,0.06);
        }

        /* ── SECTION CARDS ── */
        .section-card {
            background: var(--surface);
            border: 1px solid var(--border2);
            border-radius: 14px;
            overflow: hidden;
            margin-bottom: 24px;
            animation: fadeUp 0.5s ease backwards;
        }

        .section-card:nth-child(1) { animation-delay: 0.1s; }
        .section-card:nth-child(2) { animation-delay: 0.18s; }

        .section-header {
            padding: 14px 20px;
            border-bottom: 1px solid var(--border);
            display: flex; align-items: center; justify-content: space-between;
            background: linear-gradient(90deg, rgba(79,110,247,0.07) 0%, transparent 60%);
        }

        .section-title {
            font-family: var(--sans);
            font-weight: 700; font-size: 14px; letter-spacing: -0.2px;
            display: flex; align-items: center; gap: 10px;
        }

        .section-icon {
            width: 26px; height: 26px;
            background: rgba(79,110,247,0.15);
            border: 1px solid rgba(79,110,247,0.3);
            border-radius: 7px;
            display: flex; align-items: center; justify-content: center;
            font-size: 13px;
        }

        .section-sub {
            color: var(--text3); font-size: 11px; font-weight: 400; font-family: var(--mono);
        }

        .section-badge {
            background: var(--surface2); border: 1px solid var(--border2);
            color: var(--text2); padding: 3px 10px;
            border-radius: 12px; font-size: 10px; letter-spacing: 0.5px;
        }

        /* ── TABLE WRAPPER ── */
        .table-wrap {
            overflow: auto;
            background: #0c0c16;
        }

        /* ── SINGLE TABLE ── */
        #singleValueTableContainer .table-wrap table {
            width: 100%;
            border-collapse: collapse;
            font-family: var(--mono); font-size: 12px;
        }

        #singleValueTableContainer .table-wrap th {
            background: var(--surface2);
            color: var(--text2);
            font-size: 10px; text-transform: uppercase; letter-spacing: 1.2px;
            padding: 10px 18px;
            border-bottom: 1px solid var(--border2);
            text-align: left;
            font-weight: 600;
        }

        #singleValueTableContainer .table-wrap td {
            padding: 11px 18px;
            border-bottom: 1px solid var(--border);
            transition: background 0.15s;
        }

        #singleValueTableContainer .table-wrap tr:hover td {
            background: rgba(79,110,247,0.04);
        }

        #singleValueTableContainer .table-wrap tr:last-child td {
            border-bottom: none;
        }

        #singleValueTableContainer .table-wrap td:first-child {
            color: var(--text2);
            font-size: 11px; text-transform: capitalize; letter-spacing: 0.3px;
            width: 32%; min-width: 220px;
            border-right: 1px solid var(--border);
        }

        #singleValueTableContainer .table-wrap td:last-child {
            color: var(--cyan);
            font-weight: 500;
        }

        /* ── MULTI TABLE ── */
        #tableContainer .table-wrap table {
            width: 100%;
            border-collapse: collapse;
            font-family: var(--mono); font-size: 12px;
        }

        #tableContainer .table-wrap th {
            background: var(--surface2);
            color: var(--text2);
            font-size: 10px; text-transform: uppercase; letter-spacing: 1px;
            padding: 10px 14px;
            border-bottom: 1px solid var(--border2);
            border-right: 1px solid var(--border);
            text-align: left; font-weight: 600;
            position: sticky; top: 0; z-index: 10;
            white-space: nowrap;
        }

        #tableContainer .table-wrap td {
            padding: 10px 14px;
            border-bottom: 1px solid var(--border);
            border-right: 1px solid var(--border);
            white-space: nowrap;
            color: var(--text);
            transition: background 0.15s;
        }

        #tableContainer .table-wrap tr:hover td {
            background: rgba(79,110,247,0.05);
        }

        #tableContainer .table-wrap tr:last-child td { border-bottom: none; }

        /* Sticky # column */
        #tableContainer .table-wrap td:first-child,
        #tableContainer .table-wrap th:first-child {
            background: var(--surface2);
            position: sticky; left: 0; z-index: 11;
            width: 40px; text-align: center;
            border-right: 2px solid var(--border2);
            color: var(--text3); font-weight: 600;
        }

        #tableContainer .table-wrap th:first-child { z-index: 12; }

        #tableContainer .table-wrap tr:hover td:first-child {
            background: rgba(79,110,247,0.08);
        }

        /* Selected row */
        #tableContainer .table-wrap tr.selected td {
            background: rgba(79,110,247,0.12) !important;
        }

        #tableContainer .table-wrap tr.selected td:first-child {
            background: rgba(79,110,247,0.2) !important;
            color: var(--accent);
        }

        /* ── PLACEHOLDER ── */
        .placeholder {
            padding: 24px 20px;
            color: var(--text3);
            font-size: 12px;
            display: flex; align-items: center; gap: 10px;
        }

        .placeholder::before {
            content: '◌'; font-size: 18px; color: var(--border2);
        }

        /* ── FOOTER ── */
        .footer {
            margin-top: 32px; padding-top: 18px;
            border-top: 1px solid var(--border);
            display: flex; align-items: center; justify-content: space-between;
            color: var(--text3); font-size: 11px;
            flex-wrap: wrap; gap: 8px;
        }

        /* ── ANIMATIONS ── */
        @keyframes fadeDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes fadeUp {
            from { opacity: 0; transform: translateY(14px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: var(--bg); }
        ::-webkit-scrollbar-thumb { background: var(--border2); border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--accent); }
    </style>
</head>
<body>
<div class="container">

    <!-- HEADER -->
    <div class="header">
        <div class="header-left">
            <div class="logo-badge">URA</div>
            <div>
                <div class="header-title">Log Viewer</div>
                <div class="header-subtitle">Análise de Sessão · Fluxo Sequencial</div>
            </div>
        </div>
        <div class="version-tag">V1.10.1 &nbsp;·&nbsp; major.minor.patch</div>
    </div>

    <!-- INPUT -->
    <div class="input-section">
        <div class="input-label">Log de entrada</div>
        <textarea id="inputData" placeholder="Cole o log aqui...">cod_identificacao_ligacao	689999999999
data_hora_inicio_ligacao	04/12/2025 10:47:29
event_name_1	inicio_menu|validacao_parametro|origem_identificada|saudacao_itau|validacao_parametro|validacao|inicio_menu|validacao_dma_habilitado|opm_dma_ddd_habilitado|validacao_origem_chamada|origem_transportes|direcionamento_fluxo|inicio_menu|acionamento_lacuna|mensagem_emergencial|direcionamento_fluxo|validacao|inicio_menu|validacao||
fluxo_1	Inicio_Ura_Seguros_Assistencias|Modulo_Dial_My_App|Inicio_Ura_Seguros_Assistencias|Roteador_Unico_Lacunas|Inicio_Ura_Seguros_Assistencias|Inicio_Identificacao_Publico||
id_ura	7
indicador_1	Abandono
input_1	||||||||||||||||||||
nome_ura	Seguros_Assistencia
ponto_1	10060|10583|10589|15599|10611|11769|24501|24502|24534|24505|10615|12035|10004|11014|11016|12001|11793|10009|11794||
ponto_origem_1	||||||||||||||||||||
produto_1	ITAU//NAO_DEFINIDO
qtd_duracao_em_segundos	24
range_1	10000|10500|10500|10000|10500|11500|24500|24500|24500|24500|10500|12000|10000|11000|11000|12000|10500|10000|10500||
tentativa_1	||||||||||||||||||||
timestamp_1	04/12/2025 10:47:31|04/12/2025 10:47:31|04/12/2025 10:47:31|04/12/2025 10:47:31|04/12/2025 10:47:34|04/12/2025 10:47:41|04/12/2025 10:47:41|04/12/2025 10:47:41|04/12/2025 10:47:41|04/12/2025 10:47:41|04/12/2025 10:47:41|04/12/2025 10:47:41|04/12/2025 10:47:41|04/12/2025 10:47:41|04/12/2025 10:47:41|04/12/2025 10:47:41|04/12/2025 10:47:41|04/12/2025 10:47:41|04/12/2025 10:47:41|
timestamp_2	04/12/2025 10:47:53|
ultimo_ponto_1	11794
validacao_1	Itau_Seguros|Chamada_Autorizada|ITAU|Bom_Dia|Outras_Origens|Opm_Dma_Habilitado|Inicio_Ura_Seguros_Assistencias|Habilitado|Habilitado|Origem_Fixo|Identificacao_Publico|Direciona_Roteador_Lacunas|Inicio_Ura_Seguros_Assistencias|Primeiro_Acionamento|Mensagem_Emergencial_Desativada|Roteador_Unico_Lacunas|Outras_Origens|Inicio_Ura_Seguros_Assistencias|Origem_Uras_Relacionamento||</textarea>
    </div>

    <!-- ACTIONS -->
    <div class="controls">
        <button class="primary" onclick="processarTabela()">
            <span>⊞</span> Gerar Tabela
        </button>
        <button class="secondary" onclick="exportarCSV()">
            <span>↓</span> Baixar CSV (Excel)
        </button>
        <button class="secondary" onclick="exportarPDF()">
            <span>↓</span> Baixar PDF
        </button>
    </div>

    <!-- SINGLE POSITION TABLE -->
    <div class="section-card" id="singleValueTableContainer">
        <div class="section-header">
            <div class="section-title">
                <div class="section-icon">◈</div>
                Variáveis de Posição Única
                <span class="section-sub">(Metadados)</span>
            </div>
            <div class="section-badge" id="singleBadge">—</div>
        </div>
        <div class="placeholder">As variáveis com apenas uma posição aparecerão aqui...</div>
    </div>

    <!-- MULTI POSITION TABLE -->
    <div class="section-card" id="tableContainer">
        <div class="section-header">
            <div class="section-title">
                <div class="section-icon">⇢</div>
                Fluxo Sequencial
                <span class="section-sub">(Multi-Posição)</span>
            </div>
            <div class="section-badge" id="multiBadge">—</div>
        </div>
        <div class="placeholder">A tabela aparecerá aqui...</div>
    </div>

    <div class="footer">
        <span>⬡ URA Log Viewer · Erivan Oliveira</span>
        <span>Copyright © 2026. Todos os direitos reservados.</span>
    </div>

</div>

<script>
    let colunasGlobal = [];

    function processarTabela() {
        const inputText = document.getElementById('inputData').value;
        const lines = inputText.split('\n');
        const grupos = {};
        const regex = /\s*(\w+?)(?:_(\d+))?\s+(.*)/;

        lines.forEach(line => {
            if (!line.trim()) return;
            const match = line.match(regex);
            if (match) {
                const nomeBase = match[1];
                const indice = match[2] ? parseInt(match[2], 10) : 0;
                const conteudo = match[3].trim();
                if (!grupos[nomeBase]) grupos[nomeBase] = [];
                grupos[nomeBase].push({ idx: indice, text: conteudo });
            }
        });

        const dadosFinais = {};
        for (const [key, items] of Object.entries(grupos)) {
            items.sort((a, b) => a.idx - b.idx);
            const textoCompleto = items.map(item => item.text).join('');
            let arrayDeItens = textoCompleto.split('|').map(v => v.trim());
            if (arrayDeItens.length > 0 && arrayDeItens[arrayDeItens.length - 1] === "") {
                arrayDeItens.pop();
            }
            dadosFinais[key] = arrayDeItens;
        }

        const dadosMultiPosicao = {};
        const dadosSinglePosicao = {};
        let maxItens = 0;

        for (const [key, arrayDeItens] of Object.entries(dadosFinais)) {
            if (arrayDeItens.length === 1) {
                dadosSinglePosicao[key] = arrayDeItens[0];
            } else if (arrayDeItens.length > 0) {
                dadosMultiPosicao[key] = arrayDeItens;
                if (arrayDeItens.length > maxItens) maxItens = arrayDeItens.length;
            }
        }

        // Single Table
        const singleKeys = Object.keys(dadosSinglePosicao).sort();
        let htmlSingle = `
            <div class="section-header">
                <div class="section-title">
                    <div class="section-icon">◈</div>
                    Variáveis de Posição Única
                    <span class="section-sub">(Metadados)</span>
                </div>
                <div class="section-badge">${singleKeys.length} variáveis</div>
            </div>
            <div class="table-wrap"><table><thead><tr><th>Variável</th><th>Valor</th></tr></thead><tbody>`;
        singleKeys.forEach(key => {
            htmlSingle += `<tr><td>${key}</td><td>${dadosSinglePosicao[key]}</td></tr>`;
        });
        htmlSingle += '</tbody></table></div>';
        document.getElementById('singleValueTableContainer').innerHTML = htmlSingle;

        // Multi Table
        const ordemDesejada = [
            'event_name', 'validacao', 'fluxo', 'indicador',
            'range', 'ponto', 'ultimo_ponto', 'input',
            'tentativa', 'ponto_origem', 'timestamp'
        ];

        colunasGlobal = Object.keys(dadosMultiPosicao).sort((a, b) => {
            const indexA = ordemDesejada.indexOf(a);
            const indexB = ordemDesejada.indexOf(b);
            if (indexA !== -1 && indexB !== -1) return indexA - indexB;
            if (indexA !== -1) return -1;
            if (indexB !== -1) return 1;
            return a.localeCompare(b);
        });

        let htmlMulti = `
            <div class="section-header">
                <div class="section-title">
                    <div class="section-icon">⇢</div>
                    Fluxo Sequencial
                    <span class="section-sub">(Multi-Posição)</span>
                </div>
                <div class="section-badge">${maxItens} eventos</div>
            </div>
            <div class="table-wrap"><table><thead><tr><th>#</th>`;
        colunasGlobal.forEach(col => {
            htmlMulti += `<th>${col}</th>`;
        });
        htmlMulti += '</tr></thead><tbody>';
        for (let i = 0; i < maxItens; i++) {
            htmlMulti += `<tr><td>${i + 1}</td>`;
            colunasGlobal.forEach(col => {
                const valor = dadosMultiPosicao[col][i] !== undefined ? dadosMultiPosicao[col][i] : '';
                htmlMulti += `<td>${valor}</td>`;
            });
            htmlMulti += '</tr>';
        }
        htmlMulti += '</tbody></table></div>';
        document.getElementById('tableContainer').innerHTML = htmlMulti;

        // Row click selection
        const linhas = document.querySelectorAll("#tableContainer tbody tr");
        linhas.forEach(linha => {
            linha.addEventListener("click", () => {
                linhas.forEach(l => l.classList.remove("selected"));
                linha.classList.add("selected");
            });
        });
    }

    function exportarCSV() {
        const tableMulti = document.querySelector("#tableContainer table");
        const tableSingle = document.querySelector("#singleValueTableContainer table");
        if (!tableMulti && !tableSingle) { alert("Gere a tabela primeiro!"); return; }
        let csvContent = "";
        if (tableSingle) {
            csvContent += "--- METADADOS ---\n";
            tableSingle.querySelectorAll("tbody tr").forEach(row => {
                const cells = Array.from(row.querySelectorAll("td")).map(td => `"${td.innerText}"`);
                csvContent += cells.join(";") + "\n";
            });
            csvContent += "\n";
        }
        if (tableMulti) {
            csvContent += "--- FLUXO SEQUENCIAL ---\n";
            const headers = Array.from(tableMulti.querySelectorAll("th")).map(th => th.innerText);
            csvContent += headers.join(";") + "\n";
            tableMulti.querySelectorAll("tbody tr").forEach(row => {
                const cells = Array.from(row.querySelectorAll("td")).map(td => `"${td.innerText}"`);
                csvContent += cells.join(";") + "\n";
            });
        }
        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement("a");
        link.setAttribute("href", URL.createObjectURL(blob));
        link.setAttribute("download", "analise_log.csv");
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }

    function exportarPDF() {
        const tableMulti = document.querySelector("#tableContainer table");
        const tableSingle = document.querySelector("#singleValueTableContainer table");
        if (!tableMulti && !tableSingle) { alert("Gere a tabela primeiro!"); return; }
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF('l', 'mm', 'a4');
        let yPosition = 15;
        doc.setFontSize(16); doc.setFont(undefined, 'bold');
        doc.text('Análise de Logs - URA Log Viewer V1.10.1', 15, yPosition);
        yPosition += 10;
        if (tableSingle) {
            doc.setFontSize(12); doc.setFont(undefined, 'bold');
            doc.text('Variáveis de Posição Única (Metadados)', 15, yPosition);
            yPosition += 5;
            const dataSingle = [];
            tableSingle.querySelectorAll("tbody tr").forEach(row => {
                dataSingle.push(Array.from(row.querySelectorAll("td")).map(td => td.innerText));
            });
            doc.autoTable({
                startY: yPosition,
                head: [['Variável', 'Valor']],
                body: dataSingle,
                theme: 'grid',
                headStyles: { fillColor: [79, 110, 247], textColor: 255, fontStyle: 'bold' },
                styles: { fontSize: 8, cellPadding: 2 },
                columnStyles: { 0: { cellWidth: 60, fontStyle: 'bold' }, 1: { cellWidth: 'auto' } }
            });
            yPosition = doc.lastAutoTable.finalY + 10;
        }
        if (tableMulti) {
            if (yPosition > 180) { doc.addPage(); yPosition = 15; }
            doc.setFontSize(12); doc.setFont(undefined, 'bold');
            doc.text('Fluxo Sequencial (Multi-Posição)', 15, yPosition);
            yPosition += 5;
            const headersMulti = Array.from(tableMulti.querySelectorAll("th")).map(th => th.innerText);
            const dataMulti = [];
            tableMulti.querySelectorAll("tbody tr").forEach(row => {
                dataMulti.push(Array.from(row.querySelectorAll("td")).map(td => td.innerText));
            });
            doc.autoTable({
                startY: yPosition,
                head: [headersMulti],
                body: dataMulti,
                theme: 'grid',
                headStyles: { fillColor: [79, 110, 247], textColor: 255, fontStyle: 'bold' },
                styles: { fontSize: 7, cellPadding: 1.5, overflow: 'linebreak' },
                columnStyles: { 0: { cellWidth: 10, halign: 'center', fontStyle: 'bold' } },
                margin: { left: 10, right: 10 }
            });
        }
        const pageCount = doc.internal.getNumberOfPages();
        for (let i = 1; i <= pageCount; i++) {
            doc.setPage(i);
            doc.setFontSize(8); doc.setFont(undefined, 'normal');
            doc.text(
                `Gerado em: ${new Date().toLocaleString('pt-BR')} - Página ${i} de ${pageCount}`,
                15, doc.internal.pageSize.height - 10
            );
        }
        doc.save('analise_log.pdf');
    }
</script>
</body>
</html>
